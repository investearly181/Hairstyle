<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Virtual Hairstyle Tryâ€‘On</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    #previewCanvas, #photoCanvas {
      width:100%;
      border-radius:1rem;
    }
    #photoCanvas{display:none;}
    .thumb{cursor:pointer;transition:transform .2s;}
    .thumb:hover{transform:scale(1.05)}
    [data-step]{display:none;}
    .active{display:block;}
  </style>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col items-center p-4">
  <h1 class="text-2xl font-bold mb-6">ğŸ’‡â€â™€ï¸ Virtual Hairstyle Tryâ€‘On</h1>

  <!-- STEPâ€‘1: Gender selection -->
  <section id="step1" data-step class="active w-full max-w-md space-y-4">
    <h2 class="text-lg font-semibold text-center">Select your gender</h2>
    <div class="flex justify-around">
      <button class="bg-indigo-600 text-white px-6 py-3 rounded" onclick="chooseGender('male')">Male</button>
      <button class="bg-pink-600 text-white px-6 py-3 rounded" onclick="chooseGender('female')">Female</button>
    </div>
  </section>

  <!-- STEPâ€‘2: Camera preview & capture -->
  <section id="step2" data-step class="w-full max-w-md">
    <video id="video" autoplay playsinline class="w-full rounded-lg bg-black"></video>
    <button class="mt-4 w-full bg-green-600 text-white py-2 rounded" onclick="takePhoto()">ğŸ“¸ Capture Photo</button>
    <p class="text-center text-sm text-gray-500 mt-2">(Make sure your face is wellâ€‘lit)</p>
  </section>

  <!-- STEPâ€‘3: Display photo + hairstyle options -->
  <section id="step3" data-step class="w-full max-w-md">
    <canvas id="photoCanvas"></canvas>
    <h2 class="text-lg font-semibold mt-4 mb-2 text-center">Choose a hairstyle</h2>
    <div id="styleGrid" class="grid grid-cols-3 gap-3"></div>
  </section>

  <script>
    let gender = "male";
    let stream;
    const video = document.getElementById('video');
    const photoCanvas = document.getElementById('photoCanvas');
    const pctx = photoCanvas.getContext('2d');
    const styleGrid = document.getElementById('styleGrid');

    const maleStyles = [
      "https://i.ibb.co/k1v7HDx/male1.png",
      "https://i.ibb.co/QHpTRWj/male2.png",
      "https://i.ibb.co/PZBDLKt/male3.png"
    ];
    const femaleStyles = [
      "https://i.ibb.co/YLyDYXq/female1.png",
      "https://i.ibb.co/dgFM9yJ/female2.png",
      "https://i.ibb.co/8Nns1qg/female3.png"
    ];

    function switchStep(n){
      document.querySelectorAll('[data-step]').forEach((s,i)=>{
        s.classList.toggle('active',i===n-1);
      });
    }

    function chooseGender(g){
      gender = g;
      switchStep(2);
      startCamera();
    }

    async function startCamera(){
      try{
        stream = await navigator.mediaDevices.getUserMedia({video:{facingMode:'user'},audio:false});
        video.srcObject = stream;
      }catch(e){
        alert('Camera access denied');
      }
    }

    function takePhoto(){
      if (!stream) {
        alert("Camera not initialized.");
        return;
      }
      const w = video.videoWidth;
      const h = video.videoHeight;
      photoCanvas.width = w; 
      photoCanvas.height = h;
      pctx.drawImage(video, 0, 0, w, h);
      video.pause();
      stream.getTracks().forEach(t => t.stop());
      photoCanvas.style.display = 'block';
      generateThumbnails();
      switchStep(3);
    }

    function generateThumbnails(){
      styleGrid.innerHTML = '';
      const list = gender === 'male' ? maleStyles : femaleStyles;
      list.forEach(src => {
        const img = document.createElement('img');
        img.src = src;
        img.className = 'thumb w-full rounded';
        img.onclick = () => applyStyle(src);
        styleGrid.appendChild(img);
      });
    }

    function applyStyle(src){
      const w = photoCanvas.width;
      const h = photoCanvas.height;
      const img = new Image();
      img.src = src;
      img.onload = () => {
        pctx.drawImage(photoCanvas, 0, 0); // reset to original photo
        const ratio = 0.6; // scale factor of canvas width
        const iw = w * ratio;
        const ih = img.height / img.width * iw;
        const x = w / 2 - iw / 2;
        const y = h * 0.1;
        pctx.drawImage(img, x, y, iw, ih);
      }
    }
  </script>
</body>
</html>
